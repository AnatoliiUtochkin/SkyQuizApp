<Window x:Class="SkyQuizApp.Views.Teacher.CreateEditTestWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
        xmlns:converters="clr-namespace:SkyQuizApp.Converters"
        Title="Створити / Редагувати тест - SkyQuizApp"
        Width="520"
        Height="Auto"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="#1E1E2F"
        Foreground="White"
        WindowStyle="None">

    <Window.Resources>
        <ControlTemplate x:Key="ComboBoxToggleButtonTemplate" TargetType="ToggleButton">
            <Border Background="#2C2F48" CornerRadius="8">
                <Grid>
                    <Path Fill="White" HorizontalAlignment="Right" Margin="0,0,10,0" VerticalAlignment="Center" Width="10" Height="6" Stretch="Uniform" Data="M 0 0 L 5 5 L 10 0 Z" />
                </Grid>
            </Border>
        </ControlTemplate>

        <Style x:Key="SkyComboBox" TargetType="ComboBox">
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Background" Value="#2C2F48" />
            <Setter Property="Padding" Value="6,4" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Width" Value="180" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="OverridesDefaultStyle" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton" Template="{StaticResource ComboBoxToggleButtonTemplate}" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" ClickMode="Press" Background="Transparent" Focusable="False" />
                            <ContentPresenter Name="ContentSite" IsHitTestVisible="False" Content="{TemplateBinding SelectionBoxItem}" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="10,0,35,0" />
                            <Popup Name="PART_Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                <Border Background="#35385A" CornerRadius="8" Margin="0,4,0,0" Padding="10">
                                    <ItemsPresenter />
                                </Border>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="OverridesDefaultStyle" Value="True" />
                        <Setter Property="SnapsToDevicePixels" Value="True" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBoxItem">
                                    <Border x:Name="Bd" Background="Transparent" CornerRadius="6" Padding="8,4">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="#9084e0" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="#6C5DD3" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <converters:AttemptsLimitConverter x:Key="AttemptsLimitConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:QuestionTypeToTextConverter x:Key="QuestionTypeConverter" />

        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#2C2F48" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="Margin" Value="0,0,0,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                            <ScrollViewer x:Name="PART_ContentHost" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="RoundedButton">
            <Setter Property="Background" Value="#6C5DD3" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="Margin" Value="5,0,0,0" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="CheckBox" x:Key="ToggleSwitchStyle">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBlock Text="{TemplateBinding Content}" FontSize="16" FontWeight="Bold" Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0" />
                            <Border Width="50" Height="25" CornerRadius="10" Background="#444866">
                                <Grid>
                                    <Ellipse x:Name="SwitchThumb" Width="16" Height="16" Fill="White" Margin="2,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Center" />
                                </Grid>
                            </Border>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="SwitchThumb" Property="HorizontalAlignment" Value="Right" />
                                <Setter TargetName="SwitchThumb" Property="Margin" Value="0,0,2,0" />
                                <Setter TargetName="SwitchThumb" Property="Fill" Value="#6C5DD3" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="IconCircleButton" TargetType="Button">
            <Setter Property="Background" Value="#6C5DD3" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Width" Value="35" />
            <Setter Property="Height" Value="35" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="WatermarkTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#2C2F48" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#6C5DD3" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Height" Value="32" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8" />
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Margin="6,0,6,0"
                                          VerticalAlignment="Center" />
                            <TextBlock x:Name="Watermark"
                                       Text="{TemplateBinding Tag}"
                                       Foreground="Gray"
                                       Margin="10,0,0,0"
                                       VerticalAlignment="Center"
                                       IsHitTestVisible="False"
                                       Visibility="Collapsed" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Collapsed" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border CornerRadius="10" BorderThickness="2" BorderBrush="#6C5DD3" Padding="20"
            ScrollViewer.VerticalScrollBarVisibility="Hidden">
        <StackPanel>
            <TextBlock Text="Назва тесту" FontWeight="Bold" FontSize="16" />
            <TextBox Text="{Binding Title}" />

            <TextBlock Text="Опис (не обов’язково)" FontWeight="Bold" FontSize="16" />
            <TextBox Text="{Binding Description}" Height="60" AcceptsReturn="True" TextWrapping="Wrap" />

            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="Ліміт часу (хвилини)" FontWeight="Bold" FontSize="16" VerticalAlignment="Center" />
                <TextBox Text="{Binding TimeLimitMinutes}" Width="80" Margin="15,0,0,5" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="Кількість спроб" FontWeight="Bold" FontSize="16" VerticalAlignment="Center" Margin="0,0,15,0" />
                <ComboBox Style="{StaticResource SkyComboBox}"
                          ItemsSource="{Binding AvailableAttempts}"
                          SelectedValue="{Binding AttemptsLimit}"
                          SelectedValuePath="."
                          HorizontalContentAlignment="Center">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Converter={StaticResource AttemptsLimitConverter}}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>

            <CheckBox Content="Перемішувати питання" IsChecked="{Binding ShuffleQuestions}" Style="{StaticResource ToggleSwitchStyle}" />
            <CheckBox Content="Термін здачі" IsChecked="{Binding HasDeadline}" Style="{StaticResource ToggleSwitchStyle}" Margin="0,0,0,5" />

            <StackPanel Orientation="Horizontal"
                            Visibility="{Binding HasDeadline, Converter={StaticResource BoolToVisibilityConverter}}"
                            Margin="0,5,0,0">
                <TextBox Style="{StaticResource WatermarkTextBox}"
                             Text="{Binding DeadlineDate, Mode=TwoWay}"
                             Width="120"
                             Margin="0,0,10,0"
                             Tag="дд.мм.рррр" />
                <TextBox Style="{StaticResource WatermarkTextBox}"
                             Text="{Binding DeadlineTime, Mode=TwoWay}"
                             Width="80"
                             Tag="год:хв" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="5">
                <Button Command="{Binding AddQuestionCommand}" Style="{StaticResource RoundedButton}" Background="#6C5DD3" Width="190" Height="36" Margin="0,20,50,10" HorizontalAlignment="Center" Cursor="Hand">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <fa:IconImage Icon="Plus" Width="16" Height="16" Margin="0,0,5,0" Foreground="White" />
                        <TextBlock Text="Додати питання" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Content="Зберегти" Command="{Binding SaveCommand}" Style="{StaticResource RoundedButton}" Height="36" Width="100" />
                    <Button Content="Відміна" Click="Cancel_Click" Style="{StaticResource RoundedButton}" Background="#444866" Height="36" Width="100" />
                </StackPanel>
            </StackPanel>

            <!-- ПРОКРУТКА ПИТАНЬ + КНОПКИ -->
            <ScrollViewer VerticalScrollBarVisibility="Hidden" MaxHeight="300" Margin="0,10,0,0" Padding="0,0,0,50">
                <ItemsControl ItemsSource="{Binding Questions}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#2C2F48" CornerRadius="8" Padding="10" Margin="0,0,0,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel>
                                        <TextBlock Text="{Binding Text}" FontWeight="Bold" FontSize="14" Foreground="White"
                                                   TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" MaxWidth="340" ToolTip="{Binding Text}" />
                                        <TextBlock Text="{Binding QuestionType, Converter={StaticResource QuestionTypeConverter}}" FontSize="12" Foreground="LightGray"
                                                   FontStyle="Italic" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" MaxWidth="340" />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                                        <Button Command="{Binding DataContext.EditQuestionCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource IconCircleButton}"
                                                Background="#00BCD4"
                                                ToolTip="Редагувати"
                                                Margin="0,0,5,0">
                                            <fa:IconImage Icon="Edit" Width="16" Height="16" Foreground="White" />
                                        </Button>
                                        <Button Command="{Binding DataContext.DeleteQuestionCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource IconCircleButton}"
                                                Background="#E74C3C"
                                                ToolTip="Видалити">
                                            <fa:IconImage Icon="Trash" Width="16" Height="16" Foreground="White" />
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </StackPanel>
    </Border>
</Window>