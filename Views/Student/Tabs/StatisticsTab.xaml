<UserControl x:Class="SkyQuizApp.Views.Student.Tabs.StatisticsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:fa="clr-namespace:FontAwesome.Sharp;assembly=FontAwesome.Sharp"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:converters="clr-namespace:SkyQuizApp.Converters"
             Background="Transparent">

    <UserControl.Resources>
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter" />
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Hidden">
        <StackPanel Margin="40" Orientation="Vertical" HorizontalAlignment="Center" Width="900">
            <TextBlock Text="📊 Статистика"
                       FontSize="42"
                       FontWeight="Bold"
                       Foreground="White"
                       Margin="0,0,0,30"
                       HorizontalAlignment="Center" />

            <UniformGrid Columns="2" Rows="2" Margin="0,0,0,30" HorizontalAlignment="Center" Width="900">
                <Border Background="#2C2F48" CornerRadius="16" Padding="20" Margin="10">
                    <StackPanel>
                        <TextBlock Text="Середній бал" Foreground="White" FontWeight="Bold" FontSize="20" />
                        <TextBlock Text="{Binding AverageScorePercent, StringFormat='{}{0:F1}%'}" Foreground="LightGreen" FontSize="26" FontWeight="Bold" />
                        <TextBlock Text="{Binding AverageScore12, StringFormat='{}{0:F1} / 12'}" Foreground="White" FontSize="16" />
                        <TextBlock Text="{Binding LetterGrade, StringFormat='Оцінка: {0}'}" Foreground="White" FontSize="16" />
                    </StackPanel>
                </Border>

                <Border Background="#2C2F48" CornerRadius="16" Padding="20" Margin="10">
                    <StackPanel>
                        <TextBlock Text="Всього тестів" Foreground="White" FontWeight="Bold" FontSize="20" />
                        <TextBlock Text="{Binding TotalTestsTaken}" Foreground="White" FontSize="36" FontWeight="Bold" HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <Border Background="#2C2F48" CornerRadius="16" Padding="20" Margin="10">
                    <StackPanel>
                        <TextBlock Text="Найкращий результат" Foreground="White" FontWeight="Bold" FontSize="20" />
                        <TextBlock Text="{Binding BestTestTitle}" Foreground="LightSkyBlue" FontSize="18" />
                        <TextBlock Text="{Binding BestTestScore, StringFormat='Оцінка: {0:F1}%'}" Foreground="White" />

                        <TextBlock Foreground="White">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding BestTestDate, StringFormat='{}{0:dd.MM.yyyy}'}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding BestTestDate}" Value="{x:Static sys:DateTime.MinValue}">
                                            <Setter Property="Text" Value="Немає даних" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <Border Background="#2C2F48" CornerRadius="16" Padding="20" Margin="10">
                    <StackPanel>
                        <TextBlock Text="Найгірший результат" Foreground="White" FontWeight="Bold" FontSize="20" />
                        <TextBlock Text="{Binding WorstTestTitle}" Foreground="Salmon" FontSize="18" />
                        <TextBlock Text="{Binding WorstTestScore, StringFormat='Оцінка: {0:F1}%'}" Foreground="White" />

                        <TextBlock Foreground="White">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding WorstTestDate, StringFormat='{}{0:dd.MM.yyyy}'}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding WorstTestDate}" Value="{x:Static sys:DateTime.MinValue}">
                                            <Setter Property="Text" Value="Немає даних" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <Border Background="#2C2F48" CornerRadius="16" Padding="25" Margin="0,0,0,30">
                <StackPanel>
                    <TextBlock Text="Динаміка успішності за датами"
                               Foreground="White"
                               FontWeight="Bold"
                               FontSize="20"
                               Margin="0,0,0,10" />
                    <lvc:CartesianChart Series="{Binding ScoreSeries}" Height="300" LegendLocation="None">
                        <lvc:CartesianChart.AxisX>
                            <lvc:Axis Title="Дата" Labels="{Binding DateLabels}" LabelsRotation="15" Foreground="White" />
                        </lvc:CartesianChart.AxisX>
                        <lvc:CartesianChart.AxisY>
                            <lvc:Axis Title="%" MinValue="0" MaxValue="100" Foreground="White" />
                        </lvc:CartesianChart.AxisY>
                    </lvc:CartesianChart>
                    <TextBlock Text="Немає даних для побудови графіка"
                               Foreground="Gray"
                               FontStyle="Italic"
                               HorizontalAlignment="Center"
                               Margin="10"
                               Visibility="{Binding ScoreSeries.Count, Converter={StaticResource IntToVisibilityConverter}}" />
                </StackPanel>
            </Border>

            <Grid Margin="0,0,0,40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>

                <Border Background="#2C2F48" CornerRadius="16" Padding="25" Margin="10" Grid.Column="0">
                    <StackPanel>
                        <TextBlock Text="Тести по місяцях" Foreground="White" FontWeight="Bold" FontSize="20" Margin="0,0,0,10" />
                        <lvc:PieChart Series="{Binding PieSeries}" Height="250" Foreground="White" />
                        <TextBlock Text="Немає даних"
                                   Foreground="Gray"
                                   FontStyle="Italic"
                                   HorizontalAlignment="Center"
                                   Margin="10"
                                   Visibility="{Binding PieSeries.Count, Converter={StaticResource IntToVisibilityConverter}}" />
                    </StackPanel>
                </Border>

                <Border Background="#2C2F48" CornerRadius="16" Padding="25" Margin="10" Grid.Column="1">
                    <StackPanel>
                        <TextBlock Text="Точність по типах запитань"
                   Foreground="White"
                   FontWeight="Bold"
                   FontSize="20"
                   Margin="0,0,0,10" />

                        <lvc:CartesianChart Series="{Binding AccuracySeries}" Height="250" LegendLocation="None">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding TypeLabels}" ShowLabels="False" Foreground="White">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Stroke="Gray" StrokeThickness="1" Step="1" />
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisX>

                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis ShowLabels="True" Foreground="Transparent">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Stroke="Gray" StrokeThickness="1" Step="20" />
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>

                        <TextBlock Text="Немає даних"
                   Foreground="Gray"
                   FontStyle="Italic"
                   HorizontalAlignment="Center"
                   Margin="10"
                   Visibility="{Binding AccuracySeries.Count, Converter={StaticResource IntToVisibilityConverter}}" />
                    </StackPanel>
                </Border>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</UserControl>